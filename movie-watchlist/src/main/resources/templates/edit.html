<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Film G√ºncelle</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
          rel="stylesheet">

    <link rel="stylesheet" th:href="@{/css/home.css}">
</head>

<body class="edit-page">


<div class="container mt-2">
    <div class="row justify-content-center">
        <div class="col-md-7">

            <div class="card shadow-sm">
                <div class="card-body">

                    <h3 class="mb-4 text-center">‚úèÔ∏è Film G√ºncelle</h3>

                    <!-- Ba≈üarƒ± mesajƒ± -->
                    <div th:if="${successMessage}"
                         class="alert alert-success alert-dismissible fade show">
                        <strong th:text="${successMessage}"></strong>
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>

                    <form th:action="@{/update}"
                          th:object="${movie}"
                          method="post"
                          enctype="multipart/form-data">

                        <input type="hidden" th:field="*{id}"/>

                        <!-- Film Adƒ± -->
                        <div class="mb-3">
                            <label class="form-label">Film Adƒ±</label>
                            <input type="text" class="form-control"
                                   th:field="*{title}" required>
                        </div>

                        <!-- A√ßƒ±klama -->
                        <div class="mb-3">
                            <label class="form-label">A√ßƒ±klama</label>
                            <textarea class="form-control"
                                      rows="3"
                                      th:field="*{description}"></textarea>
                        </div>

                        <!-- T√ºrler -->
                      
<div class="mb-3">
  <label class="form-label">T√ºr</label>

  <div class="row">

    <!-- S√úTUN 1 -->
    <div class="col-md-4">
      <div class="form-check form-switch">
        <input class="form-check-input" type="checkbox" name="genres" value="Aksiyon"
               th:checked="${movie.genres.contains('Aksiyon')}">
        <label class="form-check-label">Aksiyon</label>
      </div>

      <div class="form-check form-switch">
        <input class="form-check-input" type="checkbox" name="genres" value="Bilim Kurgu"
               th:checked="${movie.genres.contains('Bilim Kurgu')}">
        <label class="form-check-label">Bilim Kurgu</label>
      </div>

      <div class="form-check form-switch">
        <input class="form-check-input" type="checkbox" name="genres" value="Drama"
               th:checked="${movie.genres.contains('Drama')}">
        <label class="form-check-label">Drama</label>
      </div>
    </div>

    <!-- S√úTUN 2 -->
    <div class="col-md-4">
      <div class="form-check form-switch">
        <input class="form-check-input" type="checkbox" name="genres" value="Fantastik"
               th:checked="${movie.genres.contains('Fantastik')}">
        <label class="form-check-label">Fantastik</label>
      </div>

      <div class="form-check form-switch">
        <input class="form-check-input" type="checkbox" name="genres" value="Gerilim"
               th:checked="${movie.genres.contains('Gerilim')}">
        <label class="form-check-label">Gerilim</label>
      </div>

      <div class="form-check form-switch">
        <input class="form-check-input" type="checkbox" name="genres" value="Macera"
               th:checked="${movie.genres.contains('Macera')}">
        <label class="form-check-label">Macera</label>
      </div>
    </div>

    <!-- S√úTUN 3 -->
    <div class="col-md-4">
      <div class="form-check form-switch">
        <input class="form-check-input" type="checkbox" name="genres" value="Polisiye"
               th:checked="${movie.genres.contains('Polisiye')}">
        <label class="form-check-label">Polisiye</label>
      </div>

      <div class="form-check form-switch">
        <input class="form-check-input" type="checkbox" name="genres" value="Romantik"
               th:checked="${movie.genres.contains('Romantik')}">
        <label class="form-check-label">Romantik</label>
      </div>

      <div class="form-check form-switch">
        <input class="form-check-input" type="checkbox" name="genres" value="Tarihi"
               th:checked="${movie.genres.contains('Tarihi')}">
        <label class="form-check-label">Tarihi</label>
      </div>

      <!-- Dƒ∞ƒûER -->
    <div class="form-check form-switch d-flex align-items-center gap-2 mt-2">
  <input class="form-check-input"
         type="checkbox"
         id="otherGenreCheck"
         th:checked="${movie.otherGenre != null and !#strings.isEmpty(movie.otherGenre)}"
         onclick="toggleOtherGenre()">

  <label class="form-check-label">Diƒüer</label>

  <input type="text"
         id="otherGenreInput"
         name="customGenre"
         class="form-control form-control-sm"
         placeholder="√∂rn: Cyberpunk"
         th:value="${movie.otherGenre}"
         th:style="${movie.otherGenre != null and !#strings.isEmpty(movie.otherGenre)}
           ? 'display:inline-block;width:140px;'
           : 'display:none;width:140px;'">
</div>

    </div>

  </div>
</div>


                        <!-- Yƒ±l -->
                        <div class="mb-3">
                            <label class="form-label">Yayƒ±n Yƒ±lƒ±</label>
                            <input type="number" class="form-control"
                                   th:field="*{releaseYear}">
                        </div>
                        
                        <!-- S√ºre -->
                  <div class="mb-3">
                           <label class="form-label">S√ºre (dk)</label>
                          <input type="number"
                           class="form-control"
                            th:field="*{duration}"
                           min="1"
                        placeholder="√ñrn: 136">
                      </div>
                      <div class="form-group full">
  <label>ƒ∞zleme Linki:</label>
  <input type="url"
         th:field="*{watchUrl}"
         placeholder="https://...">
</div>
                      
                      
                      
                      
                      
     <!-- Film G√∂rseli -->
<div class="mb-4">

    <!--  label+buton aynƒ± satƒ±r -->
    <div class="file-upload-row">
        <label class="form-label fw-semibold mb-0">
            üéûÔ∏è Film G√∂rseli
        </label>

        <button type="button"
                class="btn btn-primary btn-sm"
                onclick="document.getElementById('imageFile').click()">
            üìÅ Dosya Se√ß
        </button>
    </div>

    <!-- Gizli dosya input -->
    <input type="file"
           id="imageFile"
           name="imageFile"
           accept="image/*"
           style="display:none;"
           onchange="previewImage(this)">

    <small class="text-muted d-block mt-1">
        JPG, PNG formatlarƒ± √∂nerilir
    </small>

    <!--  G√∂rseller yan yana -->
    <div class="image-preview-row mt-3">
    
        <div th:if="${movie.imageUrl != null}" class="image-box">
            <small class="image-title">Mevcut G√∂rsel</small>
            <img th:src="${movie.imageUrl}" class="edit-movie-image">
        </div>

        <div id="previewBox" class="image-box" style="display:none;">
            <small class="image-title">Se√ßilen G√∂rsel</small>
            <img id="imagePreview" class="edit-movie-image">
        </div>

        

    </div>
</div>

                        
<!-- ƒ∞zledim -->
<div class="form-check form-switch mb-3 watched-row">
    <input class="form-check-input"
           type="checkbox"
           th:field="*{watched}"
           id="watchedCheckbox">

    <label class="form-check-label watched-label" for="watchedCheckbox">
        ƒ∞zledim
    </label>
</div>


                        <!-- Puan -->
                        <div class="mb-3" id="ratingDiv" style="display:none;">
                            <label class="form-label">Puan (1-5)</label>
                            <input type="number" class="form-control"
                                   th:field="*{rating}" min="1" max="5">
                        </div>

                        <!-- Not -->
                       <div class="mb-4">
  <label class="form-label">Kƒ±sa Not</label>
  <textarea class="form-control auto-resize"
            th:field="*{note}"
            rows="2"
            placeholder="Film yorumu hakkƒ±nda not ekleyin..."></textarea>
</div>


                        <!-- BUTONLAR -->
                        <div class="d-flex justify-content-between">
                            <button type="submit" class="btn btn-primary">
                                üíæ G√ºncellemeleri Kaydet
                            </button>

                            <a th:href="@{/manage}" class="btn btn-secondary">
                                ‚Ü©Ô∏è Geri D√∂n
                            </a>
                        </div>

                    </form>

                </div>
            </div>

        </div>
    </div>
</div>

<script>


function previewImage(input) {
    const previewBox = document.getElementById("previewBox");
    const previewImg = document.getElementById("imagePreview");

    if (input.files && input.files[0]) {
        const reader = new FileReader();

        reader.onload = function (e) {
            previewImg.src = e.target.result;
            previewBox.style.display = "block";
        };

        reader.readAsDataURL(input.files[0]);
    }
}

    function toggleOtherGenre() {
    const input = document.getElementById("otherGenreInput");
    const check = document.getElementById("otherGenreCheck");

    input.style.display = check.checked ? "inline-block" : "none";
    if (!check.checked) input.value = "";
    }
    const checkbox = document.getElementById("watchedCheckbox");
    const ratingDiv = document.getElementById("ratingDiv");

    if (checkbox.checked) ratingDiv.style.display = "block";

    checkbox.addEventListener("change", function () {
        ratingDiv.style.display = this.checked ? "block" : "none";
    });
    
    document.querySelectorAll('.auto-resize').forEach(textarea => {
    	  const resize = () => {
    	    textarea.style.height = 'auto';
    	    textarea.style.height = textarea.scrollHeight + 'px';
    	  };
    	  textarea.addEventListener('input', resize);
    	  resize(); // sayfa y√ºklenince
    	});
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>

