<head>
  <meta charset="UTF-8">
  <title>MovieHub</title>

  <!-- Bootstrap 5  -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
        rel="stylesheet">

  <link rel="stylesheet" th:href="@{/css/home.css}">
</head>


<body>

<!-- Header -->
<div class="app-header">
  <div class="header-center">
    <div class="app-title">
      <a href="/" class="app-logo">ğŸ¬ MovieHub</a>
      <div class="app-subtitle">Filmlerini takip et, dÃ¼zenle ve yÃ¶net</div>
    </div>

    <div class="app-user">
      <span>ğŸ‘‹ HoÅŸ geldiniz, <strong th:text="${username}">admin</strong></span>
      <a th:href="@{/logout}" class="logout-btn">Ã‡Ä±kÄ±ÅŸ Yap</a>
    </div>
  </div>
</div>

<!--  Alert wrapper -->
<div class="alert-wrapper">

 <!-- BaÅŸarÄ± -->
<div th:if="${successMessage}"
     id="successAlert"
     style="
       width: 730px;
       max-width: 95%;
       position: fixed;
       top: 230px;
       left: 50%;
       transform: translateX(-50%);
       background-color: #d4edda;
       color: #155724;
       padding: 3px 18px;
       text-align: center;
       font-weight: 500;
       font-size: 14px;
       box-shadow: 0 4px 12px rgba(0,0,0,0.12);
       z-index: 9999;
       border-radius: 6px;
     ">

  <span th:text="${successMessage}"></span>

  <!-- Ã‡arpÄ± -->
  <span
    onclick="this.parentElement.style.display='none'"
    style="
      position: absolute;
      right: 10px; 
      top: 50%;
      transform: translateY(-50%);
      cursor: pointer;
      font-size: 14px;
      opacity: 0.7;
    "
    onmouseover="this.style.opacity='1'"
    onmouseout="this.style.opacity='0.7'"
  >âœ–</span>

</div>



  <!-- Hata -->
  <div th:if="${error}"
       id="errorAlert"
       style="
         width: 100%;
         background-color: #f8d7da;
         color: #842029;
         padding: 12px 48px;
         text-align: center;
         font-weight: 600;
         position: relative;
         box-sizing: border-box;
         margin-top: 6px;
       ">

    <span th:text="${error}"></span>

    <!-- Ã‡arpÄ± -->
    <span
      onclick="this.parentElement.style.display='none'"
      style="
        position: absolute;
        right: 18px;
        top: 50%;
        transform: translateY(-50%);
        cursor: pointer;
        font-size: 18px;
        opacity: 0.7;
      "
      onmouseover="this.style.opacity='1'"
      onmouseout="this.style.opacity='0.7'"
    >âœ–</span>

  </div>

</div>



  
  <!-- KullanÄ±cÄ± yonlednÄ±rme -->
<div class="home-content">

  <div class="card action-card">
    <p class="action-title">LÃ¼tfen yapmak istediÄŸiniz iÅŸlemi seÃ§in</p>

    <div class="action-row">
      <select id="actionSelect">
        <option value="">Ä°ÅŸlem seÃ§in</option>
        <option value="filmEkle">ğŸ¬ Film Ekle</option>
        <option value="filmAra">ğŸ” Film Ara</option>
        <option value="filmListe">ğŸ“‹ Film Listesi</option>
      </select>

      <button type="button" onclick="goAction()" class="btn-action">
        SeÃ§
      </button>
    </div>
  </div>

</div>

  
  
  
  <!-- Section header -->
  <div class="section-header" onclick="toggleSection('filmEkle')">
      â• Film Ekle
  </div>

  <!-- Section content -->
  <div id="filmEkle" class="section-content" style="display:none;">


    <!-- Form baÅŸlangÄ±Ã§ -->
    <div class="form-wrapper">
    <form th:action="@{/add}"
          th:object="${movie}"
          method="post"
          enctype="multipart/form-data">
          
 <div class="form-grid">
 
        <div>
            <label>Film AdÄ±:</label>
            <input type="text" th:field="*{title}" required>
            <div th:if="${#fields.hasErrors('title')}"
                 th:errors="*{title}"
                 style="color:red"></div>
        </div>

        <div class="form-group full">
        <label>AÃ§Ä±klama:</label>
        <textarea th:field="*{description}" rows="4"
            placeholder="Film konusu..."></textarea>
        </div>

      <div class="form-group full">
  <label class="form-label genre-title">TÃ¼rler:</label>

  <div class="genre-grid">

    <!-- Sol sÃ¼tuun -->
    <div>
      <div class="form-check form-switch">
        <input class="form-check-input" type="checkbox" name="genres" value="Bilim Kurgu"
               th:checked="${movie.genres != null and movie.genres.contains('Bilim Kurgu')}">
        <label class="form-check-label">Bilim Kurgu</label>
      </div>

      <div class="form-check form-switch">
        <input class="form-check-input" type="checkbox" name="genres" value="Aksiyon"
               th:checked="${movie.genres != null and movie.genres.contains('Aksiyon')}">
        <label class="form-check-label">Aksiyon</label>
      </div>

      <div class="form-check form-switch">
        <input class="form-check-input" type="checkbox" name="genres" value="Gerilim"
               th:checked="${movie.genres != null and movie.genres.contains('Gerilim')}">
        <label class="form-check-label">Gerilim</label>
      </div>

      <div class="form-check form-switch">
        <input class="form-check-input" type="checkbox" name="genres" value="Drama"
               th:checked="${movie.genres != null and movie.genres.contains('Drama')}">
        <label class="form-check-label">Drama</label>
      </div>
    </div>

    <!-- SaÄŸ sutun -->
    <div>
      <div class="form-check form-switch">
        <input class="form-check-input" type="checkbox" name="genres" value="Macera"
               th:checked="${movie.genres != null and movie.genres.contains('Macera')}">
        <label class="form-check-label">Macera</label>
      </div>

      <div class="form-check form-switch">
        <input class="form-check-input" type="checkbox" name="genres" value="Romantik"
               th:checked="${movie.genres != null and movie.genres.contains('Romantik')}">
        <label class="form-check-label">Romantik</label>
      </div>

      <div class="form-check form-switch">
        <input class="form-check-input" type="checkbox" name="genres" value="Fantastik"
               th:checked="${movie.genres != null and movie.genres.contains('Fantastik')}">
        <label class="form-check-label">Fantastik</label>
      </div>

      <div class="form-check form-switch">
        <input class="form-check-input" type="checkbox" name="genres" value="Tarihi"
               th:checked="${movie.genres != null and movie.genres.contains('Tarihi')}">
        <label class="form-check-label">Tarihi</label>
      </div>
    </div>

  </div>

  <!--  DiÄŸer -->
  <div class="form-check form-switch mt-3">
    <input class="form-check-input" type="checkbox"
           id="otherGenreCheck"
           name="otherSelected" 
           th:checked="${movie.otherGenre != null}"
           onclick="toggleOtherGenreAdd()">
    <label class="form-check-label">DiÄŸer</label>
  </div>

  <input type="text"
         id="otherGenreInput"
         name="customGenre"
         class="form-control form-control-sm mt-2"
         placeholder="Ã¶rn: Ã‡ocuk, Komedi"
         th:value="${movie.otherGenre}"
         th:style="${movie.otherGenre != null} ? 'display:block' : 'display:none'">
</div>


       <div class="form-group small">
    <label>YayÄ±n YÄ±lÄ±:</label>
    <input type="number" th:field="*{releaseYear}" min="1900" max="2100" placeholder="Ã–rn: 2010">
    <div th:if="${#fields.hasErrors('releaseYear')}"
         th:errors="*{releaseYear}"
         style="color:red"></div>
    </div>

      <div class="form-group small">
      <label>SÃ¼re (dk):</label>
      <input type="number" th:field="*{duration}" min="1" placeholder="Ã–rn: 136">
      </div>
      
 <div class="form-group full watch-link">
  <label>Ä°zleme Linki:</label>
  <input type="url"
         class="watch-input"
         th:field="*{watchUrl}"
         placeholder="https://...">
</div>

      

        <div class="form-group full">
           <label>KÄ±sa Not:</label>
          <textarea th:field="*{note}" rows="3"
            placeholder="Film hakkÄ±ndaki yorumun..."></textarea>
          </div>

<div class="form-group watched-row">
  <div class="form-check form-switch">
    <input class="form-check-input"
           type="checkbox"
           th:field="*{watched}"
           id="watchedCheckbox"
           onchange="toggleRating()">

    <label class="form-check-label fw-semibold" for="watchedCheckbox">
      Ä°zledim
    </label>
  </div>

  <div id="ratingDiv" class="rating-inline" style="display:none;">
    <label class="fw-semibold">Puan (1â€“5)</label>
    <input type="number" th:field="*{rating}" min="1" max="5">
    <div th:if="${#fields.hasErrors('rating')}"
         th:errors="*{rating}"
         style="color:red"></div>
  </div>
</div>


<div class="form-group full">
  <label class="form-label fw-semibold">ğŸï¸ Film GÃ¶rseli</label>

  <!-- Gizli gerÃ§ek input -->
  <input type="file"
         id="imageFile"
         name="imageFile"
         accept="image/*"
         style="display:none;">

  <!-- GÃ¶rÃ¼nen satÄ±r -->
  <div class="file-upload-row">
    <button type="button"
            class="btn btn-primary btn-sm"
            onclick="document.getElementById('imageFile').click()">
      ğŸ“ Dosya SeÃ§
    </button>

    <span class="file-hint" id="fileHint">Dosya seÃ§ilmedi</span>
  </div>

  <small class="text-muted d-block mt-1">
    JPG, PNG formatlarÄ± Ã¶nerilir
  </small>

  <!--  SeÃ§ilen gÃ¶rseli Ã¶zileme -->
  <div id="selectedPreview" style="display:none; margin-top:12px;">
    <div class="fw-semibold mb-1">SeÃ§ilen GÃ¶rsel</div>
    <img id="previewImg"
         style="max-width:180px;
                border-radius:12px;
                box-shadow:0 8px 20px rgba(0,0,0,.35);">
  </div>
</div>



<div class="form-group full submit-row">
  <button type="submit" class="btn-add">
    â• Film Bilgisi Ekle
  </button>
</div>
  
</div>
    </form>
</div>
  </div>







  <!-- Section header -->
  <div class="section-header" onclick="toggleSection('filmAra')">
      ğŸ” Film Ara
  </div>

  <!-- Section content -->
 <div id="filmAra"
     class="section-content"
     th:style="${openSection == 'filmAra'} ? 'display:block' : 'display:none'">



    <form th:action="@{/search}" method="get" class="film-ara-form">


        <div>
            <label>Film AdÄ± ile Ara:</label><br>
            <input type="text"
       name="title"
       placeholder="Ã–rn: Inception"
       th:value="${searchTitle}">

        </div>
         
        <br>
        
                <div class="search-actions">
    <button type="submit">ğŸ” Ara</button>
    <a th:href="@{/}">ğŸ”„ TÃ¼mÃ¼nÃ¼ GÃ¶ster</a>
</div>
           <br>

        <label>TÃ¼rlerine GÃ¶re Filmler:</label><br><br>

        <div class="genre-box">

            <input type="checkbox" id="g2" name="genres" value="Aksiyon">
            <label for="g2" class="genre-pill">âš”ï¸ Aksiyon</label>
            
            <input type="checkbox" id="g15" name="genres" value="Animasyon">
            <label for="g15" class="genre-pill">ğŸ¨ Animasyon</label>
            
            <input type="checkbox" id="g16" name="genres" value="Belgesel">
             <label for="g16" class="genre-pill">ğŸ¥ Belgesel</label>

            <input type="checkbox" id="g1" name="genres" value="Bilim Kurgu">
            <label for="g1" class="genre-pill">ğŸš€ Bilim Kurgu</label>
            
            <input type="checkbox" id="g12" name="genres" value="Ã‡ocuk">
            <label for="g12" class="genre-pill">ğŸ§’ Ã‡ocuk</label>
            
            <input type="checkbox" id="g3" name="genres" value="Drama">
            <label for="g3" class="genre-pill">ğŸ­ Dram</label>

            <input type="checkbox" id="g8" name="genres" value="Fantastik">
            <label for="g8" class="genre-pill">ğŸ§™ Fantastik</label>

            <input type="checkbox" id="g5" name="genres" value="Gerilim">
            <label for="g5" class="genre-pill">ğŸ˜± Gerilim</label>
            
             <input type="checkbox" id="g16" name="genres" value="Gizem">
             <label for="g16" class="genre-pill">ğŸ•µï¸ Gizem</label>
            
            <input type="checkbox" id="g13" name="genres" value="Komedi">
            <label for="g13" class="genre-pill">ğŸ˜‚ Komedi</label>
            
            <input type="checkbox" id="g15" name="genres" value="Korku">
            <label for="g15" class="genre-pill">ğŸ‘» Korku</label>

            <input type="checkbox" id="g4" name="genres" value="Macera">
            <label for="g4" class="genre-pill">ğŸ§— Macera</label>

            <input type="checkbox" id="g10" name="genres" value="Polisiye">
            <label for="g10" class="genre-pill">ğŸ•µï¸ Polisiye</label>
            
            <input type="checkbox" id="g17" name="genres" value="Psikolojik">
            <label for="g17" class="genre-pill">ğŸ§  Psikolojik</label>
            

            <input type="checkbox" id="g6" name="genres" value="Romantik">
            <label for="g6" class="genre-pill">â¤ï¸ Romantik</label>

            <input type="checkbox" id="g9" name="genres" value="SavaÅŸ">
            <label for="g9" class="genre-pill">âš”ï¸ SavaÅŸ</label>

            <input type="checkbox" id="g11" name="genres" value="SuÃ§">
            <label for="g11" class="genre-pill">ğŸš” SuÃ§</label>

            <input type="checkbox" id="g7" name="genres" value="Tarihi">
            <label for="g7" class="genre-pill">ğŸ›ï¸ Tarihi</label>

        </div>

     
    </form>

  </div>




<!-- Section header -->
<div class="section-header" onclick="toggleSection('filmListe')">
  ğŸ¬ Film Listesi
</div>


<!-- Section content -->
<div id="filmListe"
     class="section-content"
    th:style="${openList != null and openList} ? 'display:block' : 'display:none'">


  <!-- HÄ°iÃ§ film yoksa-->
<div th:if="${#lists.isEmpty(movies)}" class="empty-state">
  <p>HenÃ¼z film eklenmedi.</p>
</div>

<!-- film kartlarÄ± (sadece film varsa) -->
<div class="movie-grid" th:if="${!#lists.isEmpty(movies)}">

  <div class="movie-card" th:each="m : ${movies}">

    
    <!-- poster (izleme link varsa tÄ±klanabÄ±lÄ±r) -->
<a th:if="${m.watchUrl != null}"
   th:href="${m.watchUrl}"
   target="_blank">

  <img th:if="${m.imageUrl != null}"
       th:src="@{${m.imageUrl}}"
       alt="poster"
       class="movie-poster">
</a>

<!-- poster (izleme linki yoksa normal) -->
<img th:if="${m.watchUrl == null and m.imageUrl != null}"
     th:src="@{${m.imageUrl}}"
     alt="poster"
     class="movie-poster">


    <!-- Poster yoksa-->
    <img th:if="${m.imageUrl == null}"
         th:src="@{/images/no-poster.png}"
         alt="poster"
         class="movie-poster">

    <!-- â­ puan -->
    <div class="movie-rating" th:if="${m.rating != null}">
      â­ <span th:text="${m.rating}"></span>
    </div>

    <!-- Alt bilgi -->
    <div class="movie-info">
      <div class="movie-title" th:text="${m.title}"></div>
      <div class="movie-genre"
           th:text="${#strings.listJoin(m.genres, ', ')}"></div>
    </div>

  </div>
</div>

</div>

<div id="filmListInfo"
     th:if="${openSection == 'filmListe'}"
     class="film-list-info">
  <a href="/manage" class="btn btn-primary film-info-link">
    âœï¸ Film bilgilerini gÃ¶rÃ¼ntÃ¼lemek ve dÃ¼zenleme yapmak iÃ§in tÄ±klayÄ±n
  </a>
</div>





<script>

function closeAlert() {
	  const box = document.getElementById("alertBox");
	  if (box) box.style.display = "none";
	}

	function closeError() {
	  const box = document.getElementById("errorBox");
	  if (box) box.style.display = "none";
	}
document.addEventListener("DOMContentLoaded", function () {
    const section = /*[[${openSection}]]*/ null;
    if (section) {
      document.getElementById(section).style.display = "block";
    }
  });

     function toggleOtherGenreAdd() {
	  const check = document.getElementById("otherGenreCheck");
	  const input = document.getElementById("otherGenreInput");

	  if (check.checked) {
	    input.style.display = "block";
	    input.focus();
	  } else {
	    input.style.display = "none";
	    input.value = "";
	  }
     }


  const checkbox = document.getElementById("watchedCheckbox");
  const ratingDiv = document.getElementById("ratingDiv");

  if (checkbox && ratingDiv) {
    checkbox.addEventListener("change", function () {
      ratingDiv.style.display = this.checked ? "block" : "none";
    });
  }


  function hideInfoBox() {
    const box = document.getElementById("infoBox");
    if (box) box.style.display = "none";
    sessionStorage.setItem("hideInfoBox", "true");
  }

  document.addEventListener("DOMContentLoaded", function () {
    if (sessionStorage.getItem("hideInfoBox") === "true") {
      const box = document.getElementById("infoBox");
      if (box) box.style.display = "none";
    }
  });

  document.querySelectorAll('.genre-box input[type="checkbox"]')
    .forEach(cb => {
      cb.addEventListener('change', () => {
        cb.closest('form').submit();
      });
    });

  function toggleSection(id) {
	  const content = document.getElementById(id);
	  if (!content) return;

	  const infoBox = document.getElementById("infoBox");
	  const filmInfo = document.getElementById("filmListInfo");

	  const isOpen = content.style.display === "block";

	  document.querySelectorAll(".section-content")
	    .forEach(el => el.style.display = "none");

	  document.querySelectorAll(".section-header")
	    .forEach(h => h.classList.remove("active"));

	  if (infoBox) infoBox.style.display = "none";
	  if (filmInfo) filmInfo.style.display = "none";

	  if (!isOpen) {
	    content.style.display = "block";

	    if (id === "filmListe") {
	      if (infoBox) infoBox.style.display = "block";
	      if (filmInfo) filmInfo.style.display = "block";
	    }
	  }
	}


  function goAction() {
	  const action = document.getElementById("actionSelect").value;
	  if (!action) return;

	  document.querySelectorAll(".section-content")
	    .forEach(el => el.style.display = "none");

	  const infoBox = document.getElementById("infoBox");
	  const filmInfo = document.getElementById("filmListInfo");

	  if (infoBox) infoBox.style.display = "none";
	  if (filmInfo) filmInfo.style.display = "none";

	  const target = document.getElementById(action);
	  if (target) {
	    target.style.display = "block";
	    target.scrollIntoView({ behavior: "smooth" });

	    if (action === "filmListe") {
	      if (infoBox) infoBox.style.display = "block";
	      if (filmInfo) filmInfo.style.display = "block";
	    }
	  }
	}
    

  document.getElementById("imageFile").addEventListener("change", function (e) {
    const file = e.target.files[0];
    const previewBox = document.getElementById("selectedPreview");
    const previewImg = document.getElementById("previewImg");
    const hint = document.querySelector(".file-hint");

    if (!file) {
      previewBox.style.display = "none";
      previewImg.src = "";
      hint.textContent = "Dosya seÃ§ilmedi";
      return;
    }

    // sadece resim kontrolÃ¼
    if (!file.type.startsWith("image/")) {
      alert("LÃ¼tfen bir resim dosyasÄ± seÃ§in");
      e.target.value = "";
      return;
    }

    const reader = new FileReader();
    reader.onload = function () {
      previewImg.src = reader.result;
      previewBox.style.display = "block";
    };
    reader.readAsDataURL(file);

    hint.textContent = file.name;
  });
  
  setTimeout(() => {
	    const alert = document.getElementById("successAlert");
	    if (alert) {
	      alert.style.opacity = "0";
	      setTimeout(() => alert.style.display = "none", 300);
	    }
	  }, 3000); // â±ï¸ 3 saniye

	  
</script>



</body>

</html>
